<div class="container mt-4">
    <!-- Header -->
    <div class="d-flex align-items-center mb-4">
        <mat-icon class="me-2" color="primary">{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
        <h1 class="mat-h1 mb-0">
            {{ isEditMode ? 'Editar Tarefa' : 'Nova Tarefa' }}
        </h1>
    </div>
    <p class="text-muted mb-4">
        {{ isEditMode ? 'Modifique os dados da tarefa' : 'Preencha os dados da nova tarefa' }}
    </p>

    <!-- Loading Card -->
    <mat-card *ngIf="loading" class="text-center py-5">
        <mat-card-content>
            <mat-spinner diameter="50"></mat-spinner>
            <p class="mt-3">{{ isEditMode ? 'Carregando dados...' : 'Salvando...' }}</p>
        </mat-card-content>
    </mat-card>

    <!-- Error Card -->
    <mat-card *ngIf="!loading && errorMessage" class="error-card mb-4">
        <mat-card-header>
            <mat-icon mat-card-avatar color="warn">error</mat-icon>
            <mat-card-title>Erro</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <p>{{ errorMessage }}</p>
        </mat-card-content>
        <mat-card-actions>
            <button mat-button color="primary" (click)="onCancel()">
                <mat-icon>arrow_back</mat-icon>
                Voltar
            </button>
        </mat-card-actions>
    </mat-card>

    <!-- Form Card - Mostra quando NÃO está carregando -->
    <mat-card *ngIf="!loading">
        <mat-card-content>
            <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="task-form">

                <!-- Nome da Tarefa -->
                <mat-form-field appearance="outline" class="w-100 mb-3">
                    <mat-label>Nome da Tarefa</mat-label>
                    <input matInput formControlName="name" placeholder="Digite o nome da tarefa" maxlength="100">
                    <mat-icon matSuffix>title</mat-icon>
                    <mat-hint>Máximo 100 caracteres</mat-hint>
                    <mat-error *ngIf="name?.hasError('required')">
                        Nome é obrigatório
                    </mat-error>
                    <mat-error *ngIf="name?.hasError('maxlength')">
                        Nome deve ter no máximo 100 caracteres
                    </mat-error>
                </mat-form-field>

                <!-- Custo -->
                <mat-form-field appearance="outline" class="w-100 mb-3">
                    <mat-label>Custo (R$)</mat-label>
                    <input matInput type="number" formControlName="cost" placeholder="0.00" min="0" step="0.01">
                    <mat-icon matSuffix>attach_money</mat-icon>
                    <mat-error *ngIf="cost?.hasError('required')">
                        Custo é obrigatório
                    </mat-error>
                    <mat-error *ngIf="cost?.hasError('min')">
                        Custo deve ser maior ou igual a zero
                    </mat-error>
                </mat-form-field>

                <!-- Data Limite -->
                <mat-form-field appearance="outline" class="w-100 mb-4">
                    <mat-label>Data Limite</mat-label>
                    <input matInput type="datetime-local" formControlName="dueDate">
                    <mat-icon matSuffix>schedule</mat-icon>
                    <mat-error *ngIf="dueDate?.hasError('required')">
                        Data limite é obrigatória
                    </mat-error>
                </mat-form-field>

                <!-- Botões -->
                <div class="d-flex justify-content-between gap-3">
                    <button type="button" mat-stroked-button color="primary" (click)="onCancel()" class="flex-fill">
                        <mat-icon>cancel</mat-icon>
                        Cancelar
                    </button>

                    <button type="submit" mat-raised-button color="primary" [disabled]="taskForm.invalid || loading"
                        class="flex-fill">
                        <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
                        {{ isEditMode ? 'Atualizar' : 'Criar' }}
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>

    <!-- Debug Info (apenas em desenvolvimento) -->
    <mat-card *ngIf="!loading" class="mt-4 debug-card">
        <mat-card-header>
            <mat-icon mat-card-avatar>bug_report</mat-icon>
            <mat-card-title>Debug Info</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <p><strong>Modo:</strong> {{ isEditMode ? 'Edição' : 'Criação' }}</p>
            <p><strong>Task ID:</strong> {{ taskId || 'N/A' }}</p>
            <p><strong>Form Valid:</strong> {{ taskForm.valid }}</p>
            <p><strong>Form Value:</strong></p>
            <pre>{{ taskForm.value | json }}</pre>
        </mat-card-content>
    </mat-card>
</div>