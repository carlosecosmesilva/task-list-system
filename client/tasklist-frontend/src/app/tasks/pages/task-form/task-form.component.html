<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <mat-card>
                <mat-card-header>
                    <mat-icon mat-card-avatar [color]="isEditMode ? 'accent' : 'primary'">
                        {{ isEditMode ? 'edit' : 'add_task' }}
                    </mat-icon>
                    <mat-card-title>{{ isEditMode ? 'Editar Tarefa' : 'Nova Tarefa' }}</mat-card-title>
                    <mat-card-subtitle>{{ isEditMode ? 'Modifique os dados da tarefa' : 'Preencha os dados da nova
                        tarefa' }}</mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                    <!-- Loading Spinner -->
                    <div *ngIf="loading" class="text-center py-4">
                        <mat-spinner diameter="40"></mat-spinner>
                        <p class="mt-2">{{ isEditMode ? 'Carregando dados...' : 'Salvando...' }}</p>
                    </div>

                    <!-- Error Message -->
                    <mat-card *ngIf="errorMessage" class="error-card mb-3" color="warn">
                        <mat-card-content>
                            <div class="d-flex align-items-center">
                                <mat-icon color="warn" class="me-2">error</mat-icon>
                                <span>{{ errorMessage }}</span>
                                <button mat-icon-button (click)="errorMessage = ''" class="ms-auto">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </div>
                        </mat-card-content>
                    </mat-card>

                    <!-- Form -->
                    <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
                        <div class="form-fields">
                            <!-- Nome da Tarefa -->
                            <mat-form-field appearance="outline" class="full-width">
                                <mat-label>Nome da Tarefa</mat-label>
                                <input matInput formControlName="name" placeholder="Digite o nome da tarefa"
                                    maxlength="100">
                                <mat-icon matSuffix>title</mat-icon>
                                <mat-hint>Máximo 100 caracteres</mat-hint>
                                <mat-error *ngIf="name?.hasError('required')">
                                    Nome é obrigatório
                                </mat-error>
                                <mat-error *ngIf="name?.hasError('maxlength')">
                                    Nome deve ter no máximo 100 caracteres
                                </mat-error>
                            </mat-form-field>

                            <!-- Custo -->
                            <mat-form-field appearance="outline" class="full-width">
                                <mat-label>Custo (R$)</mat-label>
                                <input matInput type="number" formControlName="cost" step="0.01" min="0"
                                    placeholder="0.00">
                                <mat-icon matSuffix>attach_money</mat-icon>
                                <mat-hint>Valor em reais</mat-hint>
                                <mat-error *ngIf="cost?.hasError('required')">
                                    Custo é obrigatório
                                </mat-error>
                                <mat-error *ngIf="cost?.hasError('min')">
                                    Custo deve ser maior ou igual a zero
                                </mat-error>
                            </mat-form-field>

                            <!-- Data e Hora Limite -->
                            <mat-form-field appearance="outline" class="full-width">
                                <mat-label>Data e Hora Limite</mat-label>
                                <input matInput type="datetime-local" formControlName="dueDate">
                                <mat-icon matSuffix>schedule</mat-icon>
                                <mat-hint>Selecione data e hora limite</mat-hint>
                                <mat-error *ngIf="dueDate?.hasError('required')">
                                    Data limite é obrigatória
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </form>
                </mat-card-content>

                <mat-card-actions align="end" *ngIf="!loading">
                    <button mat-button type="button" (click)="onCancel()">
                        <mat-icon>cancel</mat-icon>
                        Cancelar
                    </button>
                    <button mat-raised-button color="primary" type="submit" (click)="onSubmit()"
                        [disabled]="taskForm.invalid">
                        <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
                        {{ isEditMode ? 'Atualizar' : 'Criar' }} Tarefa
                    </button>
                </mat-card-actions>
            </mat-card>
        </div>
    </div>
</div>